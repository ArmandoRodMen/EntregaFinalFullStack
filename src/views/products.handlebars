<div class="section">
    <div class="section">
        <a class="btn btn-warning" href="/api/sessions/current">Checar mi rol</a>
        <a class="btn btn-info" href="/chat">Chat</a>
        <a class="btn btn-success" href="/products">Productos</a>
        <a class="btn btn-secondary" href="/cart/{{idCart}}">Mi carrito</a>
        <a class="btn btn-danger" href="/api/sessions/{{idUser}}/signout">Logout</a>
    </div>

    <h2 class="subtitle is-1">¡Hola {{username}}!</h2>
    <h2 class="subtitle is-2">Los productos son: </h2>

    {{#each products}}
        <div class="section">
            <div class="card" style="width: 18rem;">
                <img class="card-img-top" src="{{this.thumbnail}}" width="100" alt="{{this.description}}">
                <div class="card-body">
                    <h5 class="card-title">{{this.title}}</h5>
                    <p class="card-text">{{this.description}}</p>
                    <p class="card-text">Precio: $ {{this.price}}</p>
                    <p class="card-text">Stock: {{this.stock}}</p>
                    <p class="card-text">Category: {{this.category}}</p>
                    <br>
                    <button type="button" onclick="addProductToCart('{{../idCart}}', '{{this._id}}')" class="btn btn-success">Agregar {{this._id}} al carrito {{../idCart}}</button>
                </div>
            </div>
        </div>
    {{/each}}
</div>

<script>
function addProductToCart(idCart, idProduct) {
    fetch(`/api/carts/${idCart}/products/${idProduct}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
        })
    }).then(response => {
        if(response.ok) {
            Toastify({
                text: "Producto añadido al carrito exitosamente",
                duration: 3000,
                newWindow: true,
                close: true,
                gravity: "top", // `top` or `bottom`
                position: "right", // `left`, `center` or `right`
                stopOnFocus: true, // Prevents dismissing of toast on hover
                style: {
                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                },
            }).showToast();
        } else {
            Toastify({
                text: "Error al añadir el producto al carrito",
                duration: 3000,
                newWindow: true,
                close: true,
                gravity: "top",
                position: "right",
                stopOnFocus: true,
                style: {
                    background: "linear-gradient(to right, #ff5f6d, #ffc371)",
                },
            }).showToast();
        }
    }).catch(error => {
        console.error('Error:', error);
        Toastify({
            text: "Error al procesar la petición",
            duration: 3000,
            newWindow: true,
            close: true,
            gravity: "top",
            position: "right",
            stopOnFocus: true,
            style: {
                background: "linear-gradient(to right, #ff5f6d, #ffc371)",
            },
        }).showToast();
    });
}
</script>
